<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Explore cutting-edge statistics and data science methodology with applications in sports and health analytics">

<title>SURE 2023 - Linear Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//files/cmu-statds-icon-hex-2-bg.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta property="og:title" content="SURE 2023 - Linear Regression">
<meta property="og:description" content="">
<meta property="og:image" content="https://cmu-sure-2023.netlify.app//files/cmu-statds-icon-hex-2-bg.png">
<meta property="og:site-name" content="SURE 2023">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="2000">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="SURE 2023 - Linear Regression">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://cmu-sure-2023.netlify.app//files/cmu-statds-icon-hex-2-bg.png">
<meta name="twitter:creator" content="@CMU_Stats">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="2000">
<meta name="twitter:image-width" content="1728">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../files/cmu-statds-icon-hex-2-bg.png" alt="SURE 2023 logo." class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SURE 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../people.html" rel="" target="">
 <span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../class/index.html" rel="" target="">
 <span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../assignment/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-guides" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Guides</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-guides">    
        <li class="dropdown-header">SURE 2023 Computing Setup</li>
        <li>
    <a class="dropdown-item" href="../guides/computing-setup.html" rel="" target="">
 <span class="dropdown-text">Computing Setup</span></a>
  </li>  
        <li class="dropdown-header">SURE 2023 Pittsburgh Resources</li>
        <li>
    <a class="dropdown-item" href="../guides/pittsburgh-student-resources.html" rel="" target="">
 <span class="dropdown-text">Pittsburgh-based resources</span></a>
  </li>  
        <li class="dropdown-header">SURE 2023 Exploring Pittsburgh</li>
        <li>
    <a class="dropdown-item" href="../guides/pittsburgh-fun-activities.html" rel="" target="">
 <span class="dropdown-text">Fun activities to do in Pittsburgh</span></a>
  </li>  
        <li class="dropdown-header">SURE 2023 Website Credits</li>
        <li>
    <a class="dropdown-item" href="../credits.html" rel="" target="">
 <span class="dropdown-text">Website Credits</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://cmu-sure-2023.slack.com" rel="" target=""><i class="bi bi-slack" role="img" aria-label="Slack">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../assignment/demo-lab-01.html">Demo Labs</a></li><li class="breadcrumb-item"><a href="../assignment/demo-lab-06.html">Demo Lab 6: Linear Regression</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Demo Labs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo Lab 1: Intro to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo Lab 2: Data wrangling with dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo Lab 3: Data visualization practice with ggplot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo Lab 4: Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demo Lab 5: Clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/demo-lab-06.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Demo Lab 6: Linear Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">CMSAC Mini projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/mini-project-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EDA Mini-Project 1: Requirements and Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Final projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/optum-project-guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optum Research Project Specification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignment/report-writing-guideline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SURE 2023 Report Writing Guideline</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals" id="toc-goals" class="nav-link active" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">1. <strong>EDA</strong></a></li>
  <li><a href="#fit-a-simple-linear-model" id="toc-fit-a-simple-linear-model" class="nav-link" data-scroll-target="#fit-a-simple-linear-model">2. <strong>Fit a simple linear model</strong></a></li>
  <li><a href="#assess-the-model-summary" id="toc-assess-the-model-summary" class="nav-link" data-scroll-target="#assess-the-model-summary">3. <strong>Assess the model summary</strong></a></li>
  <li><a href="#repeat-steps-2-and-3-above-for-each-of-the-different-continuous-variables" id="toc-repeat-steps-2-and-3-above-for-each-of-the-different-continuous-variables" class="nav-link" data-scroll-target="#repeat-steps-2-and-3-above-for-each-of-the-different-continuous-variables">4. <strong>Repeat steps 2 and 3 above for each of the different continuous variables</strong></a></li>
  <li><a href="#include-multiple-covariates-in-your-regression" id="toc-include-multiple-covariates-in-your-regression" class="nav-link" data-scroll-target="#include-multiple-covariates-in-your-regression">5. <strong>Include multiple covariates in your regression</strong></a></li>
  <li><a href="#linear-model-with-one-categorical-variable" id="toc-linear-model-with-one-categorical-variable" class="nav-link" data-scroll-target="#linear-model-with-one-categorical-variable">6. Linear model with one categorical variable</a></li>
  <li><a href="#linear-model-with-one-categorical-and-one-continuous-variable" id="toc-linear-model-with-one-categorical-and-one-continuous-variable" class="nav-link" data-scroll-target="#linear-model-with-one-categorical-and-one-continuous-variable">7. Linear model with one categorical AND one continuous variable</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions">8. Interactions</a></li>
  <li><a href="#polynomials" id="toc-polynomials" class="nav-link" data-scroll-target="#polynomials">9. Polynomials</a></li>
  <li><a href="#training-and-testing" id="toc-training-and-testing" class="nav-link" data-scroll-target="#training-and-testing">10. Training and testing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header">
<div class="quarto-title-block d-none d-lg-block"><div><h1 class="title">Linear Regression</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>

<div class="date-block bg-assignment text-white p-2">
  <p class="date">Released on Monday, June 26, 2023</p>
</div>
</header>

<section id="goals" class="level2">
<h2 class="anchored" data-anchor-id="goals">Goals</h2>
<p>We will briefly review linear modeling, focusing on building and assessing linear models in R. We have four main goals in this lab:</p>
<ul>
<li><p>use exploratory data analysis (EDA) and visualization to determine a) whether two variables have a linear relationship, and b) among a set of explanatory variables, which one(s) seem like the best candidates for predicting a given output variable.</p></li>
<li><p>fit and interpret simple regression models,</p></li>
<li><p>look at diagnostic plots to determine whether a linear model is a good fit for our data,</p></li>
<li><p>assess our fitted linear models.</p></li>
</ul>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="sports" class="level4">
<h4 class="anchored" data-anchor-id="sports">(SPORTS)</h4>
<p>Execute the following code chunk to (a) load the necessary data for this lab, (b) compute four variables we will use in this lab, (c) remove players with missing data (just to simplify things), and (d) subset out players with low minute totals (fewer than 250 minutes played in a season):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.stat.cmu.edu/cmsac/sure/2022/materials/data/sports/intro_r/nba_2022_player_stats.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize player stats across multiple teams they played for:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(player) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">age =</span> <span class="fu">first</span>(age),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">first</span>(position),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">games =</span> <span class="fu">sum</span>(games, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">minutes_played =</span> <span class="fu">sum</span>(minutes_played, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">field_goals =</span> <span class="fu">sum</span>(field_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">field_goal_attempts =</span> <span class="fu">sum</span>(field_goal_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">three_pointers =</span> <span class="fu">sum</span>(three_pointers, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">three_point_attempts =</span> <span class="fu">sum</span>(three_point_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">free_throws =</span> <span class="fu">sum</span>(free_throws, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">free_throw_attempts =</span> <span class="fu">sum</span>(free_throw_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">field_goal_percentage =</span> field_goals <span class="sc">/</span> field_goal_attempts,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">three_point_percentage =</span> three_pointers <span class="sc">/</span> three_point_attempts,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">free_throw_percentage =</span> free_throws <span class="sc">/</span> free_throw_attempts,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">min_per_game =</span> minutes_played <span class="sc">/</span> games) <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows with missing missing values</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minutes_played <span class="sc">&gt;</span> <span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="which-players-play-the-most-minutes-game" class="level5">
<h5 class="anchored" data-anchor-id="which-players-play-the-most-minutes-game">Which players play the most minutes / game?</h5>
<p>In the National Basketball Association (NBA), and more generally in team sports, a coach must make decisions about how many minutes each player should play. Typically, these decisions are informed by a player’s skills, along with other factors such as fatigue, matchups, etc. Our goal is to use measurements of a few (quantifiable) player attributes to predict the minutes per game a player plays. In particular, we will focus on the following data, measured over the 2022 NBA regular season for over 400 players:</p>
<ul>
<li><code>player</code>: names of each player (not useful for modeling purposes, but just for reference)</li>
<li><code>min_per_game</code>: our <strong>response variable</strong>, measuring the minutes per game a player played during the 2022 NBA regular season.</li>
<li><code>field_goal_percentage</code>: potential (continuous) <strong>explanatory variable</strong>, calculated as (number of made field goals) / (number of field goals attempted).</li>
<li><code>free_throw_percentage</code>: potential (continuous) <strong>explanatory variable</strong>, calculated as (number of made free throws) / (number of free throws attempted).</li>
<li><code>three_point_percentage</code>: potential (continuous) <strong>explanatory variable</strong>, calculated as (number of made 3 point shots) / (number of 3 point shots attempted),</li>
<li><code>age</code>: potential (continuous / discrete) <strong>explanatory variable</strong>, player’s reported age for the 2022 season,</li>
<li><code>position</code>: potential (categorical) explanatory variable, one of <code>SG</code> (shooting guard), <code>PG</code> (point guard), <code>C</code> (center), <code>PF</code> (power forward) or <code>SF</code> (small forward).</li>
</ul>
</section>
</section>
<section id="health" class="level4">
<h4 class="anchored" data-anchor-id="health">(HEALTH)</h4>
<p>Execute the following code chunk to load the heart disease dataset we worked with before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.stat.cmu.edu/cmsac/sure/2022/materials/data/health/intro_r/heart_disease.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This dataset consists of 788 heart disease patients (608 women, 180 men). Your goal is to predict the <code>Cost</code> column, which corresponds to the patient’s total cost of claims by subscriber (i.e., <code>Cost</code> is the response variable). You have access to the following explanatory variables:</p>
<ul>
<li><code>Age</code>: Age of subscriber (years)</li>
<li><code>Gender</code>: Gender of subscriber</li>
<li><code>Interventions</code>: Total number of interventions or procedures carried out</li>
<li><code>Drugs</code>: Categorized number of drugs prescribed: 0 if none, 1 if one, 2 if more than one</li>
<li><code>ERVisit</code>: Number of emergency room visits</li>
<li><code>Complications</code>: Whether or not the subscriber had complications: 1 if yes, 0 if no</li>
<li><code>Comorbidities</code>: Number of other diseases that the subscriber had</li>
<li><code>Duration</code>: Number of days of duration of treatment condition</li>
</ul>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="eda" class="level3">
<h3 class="anchored" data-anchor-id="eda">1. <strong>EDA</strong></h3>
<p>Spend time exploring the dataset, to visually assess which of the <strong>explanatory</strong> variables listed above is most associated with our response: the minutes played per game (<code>min_per_game</code>) for (SPORTS), or <code>Cost</code> for (HEALTH). Create scatterplots between the response and each continuous explanatory variable. <strong>Do any of the relationship appear to be linear?</strong> Describe the direction and strength of the association between the explanatory and response variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In your opinion, <strong>which of the possible continuous explanatory variables displays the strongest relationship with our response variable</strong>?</p>
<section id="sports-1" class="level4">
<h4 class="anchored" data-anchor-id="sports-1">(SPORTS)</h4>
<p>Create an appropriate visualization comparing the distribution of minutes per game <em>by position</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do you think there is a relationship between minutes per game and position?</strong></p>
</section>
<section id="health-1" class="level4">
<h4 class="anchored" data-anchor-id="health-1">(HEALTH)</h4>
<p>Create an appropriate visualization comparing the distribution of cost <em>by gender</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do you think there is a relationship between cost and gender?</strong></p>
</section>
</section>
<section id="fit-a-simple-linear-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-a-simple-linear-model">2. <strong>Fit a simple linear model</strong></h3>
<p>Now that you’ve performed some EDA, it’s time to actually fit some linear models to the data. Start the variable you think displays the strongest relationship with the response variable. <strong>Update the following code by replacing INSERT_VARIABLE with your selected variable, and run to fit the model</strong>:</p>
<section id="sports-2" class="level4">
<h4 class="anchored" data-anchor-id="sports-2">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>init_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> nba_data_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before checking out the <code>summary()</code> of this model, <strong>you need to check the diagnostics</strong> to see if it meets the necessary assumptions. To do this you can try running <code>plot(init_nba_lm)</code> in the console (what happens?). Equivalently, another way to make the same plots but with <code>ggplot2</code> perks is with the <a href="https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_lm.html"><code>ggfortify</code></a> package by running the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by running the following line (uncomment it!) in the console</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggfortify")</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(init_nba_lm) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-2" class="level4">
<h4 class="anchored" data-anchor-id="health-2">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>init_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Cost <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before check out the <code>summary()</code> of this model, <strong>you need to check the diagnostics</strong> to see if it meets the necessary assumptions. To do this you can try running <code>plot(init_cost_lm)</code> in the console (what happens?). Equivalently, another way to make the same plots but with <code>ggplot2</code> perks is with the <a href="https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_lm.html"><code>ggfortify</code></a> package by running the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by running the following line (uncomment it!) in the console</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggfortify")</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(init_cost_lm) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-together-now" class="level4">
<h4 class="anchored" data-anchor-id="all-together-now">(ALL TOGETHER NOW)</h4>
<p>The first plot is <strong>residuals vs.&nbsp;fitted</strong>: this plot should NOT display any clear patterns in the data, no obvious outliers, and be symmetric around the horizontal line at zero. The smooth line provided is just for reference to see how the residual average changes. <strong>Do you see any obvious patterns in your plot for this model?</strong></p>
<p>The second plot is a <a href="http://www.stat.cmu.edu/~cshalizi/TALR/TALR.pdf">Q-Q plot</a> (p.&nbsp;93). Without getting too much into the math behind them, <strong>the closer the observations are to the dashed reference line, the better your model fit is.</strong> It is bad for the observations to diverge from the dashed line in a systematic way - that means we are violating the assumption of normality discussed in lecture. <strong>How do your points look relative to the dashed reference line?</strong></p>
<p>The third plot looks at the square root of the absolute value of the standardized residiuals. We want to check for homoskedascity of errors (equal, constant variance). <strong>If we did have constant variance, what would we expect to see?</strong> <strong>What does your plot look like?</strong></p>
<p>The fourth plot is residuals vs.&nbsp;leverage which helps us identify <strong>influential</strong> points. <strong>Leverage</strong> quanitifies the influence the observed response for a particular observation has on its predicted value, i.e.&nbsp;if the leverage is small then the observed response has a small role in the value of its predicted reponse, while a large leverage indicates the observed response plays a large role in the predicted response. Its a value between 0 and 1, where the sum of all leverage values equals the number of coefficients (including the intercept). Specifically the leverage for observation <span class="math inline">\(i\)</span> is computed as:</p>
<p><span class="math display">\[h_{ii} = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\sum_i^n (x_i - \bar{x})^2}\]</span> where <span class="math inline">\(\bar{x}\)</span> is the average value for variable <span class="math inline">\(x\)</span> across all observations. <a href="http://www.stat.cmu.edu/~cshalizi/TALR/TALR.pdf">See page 191 for more details on leverage and the regression hat matrix</a>. We’re looking for points in the upper right or lower right corners, where dashed lines for <a href="https://en.wikipedia.org/wiki/Cook%27s_distance">Cook’s distance</a> values would indicate potential outlier points that are displaying too much influence on the model results. <strong>Do you observed any such influential points in upper or lower right corners?</strong></p>
<p><strong>What is your final assessment of the diagnostics, do you believe all assumptions are met? Any potential outlier observations to remove?</strong></p>
</section>
<section id="health-3" class="level4">
<h4 class="anchored" data-anchor-id="health-3">(HEALTH)</h4>
<p><strong>SPOILER ALERT</strong> An obvious result from looking at the residual diagnostics above is that we are clearly violating the assumption of Normality. <strong>Why do you think we’re violating this assumption?</strong> (HINT: Display a histogram of the <code>Cost</code> variable.)</p>
<p>One way of addressing this concern is to apply a transformation to the response variable, in this case <code>Cost</code>. A common transformation for any type of dollar amount is to use the <code>log()</code> transformation. Run the following code chunk to create a new <code>log_cost</code> variable that we will use for the remainder of the lab.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_cost =</span> <span class="fu">log</span>(Cost <span class="sc">+</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Why did we need to <code>+ 1</code> before taking the <code>log()</code>?</strong> (HINT: Look at the minimum of <code>Cost</code>.) Now make another histogram, this time for the new <code>log_cost</code> variable - what happened to the distribution?</p>
<p>Now fit the same model as before using the following code chunk. <strong>Update the following code by replacing INSERT_VARIABLE with your selected variable, and run to fit the model</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>log_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="assess-the-model-summary" class="level3">
<h3 class="anchored" data-anchor-id="assess-the-model-summary">3. <strong>Assess the model summary</strong></h3>
<p>Following the example in lecture, interpret the results from the <code>summary()</code> function on your initial model. <strong>Do you think there is sufficient evidence to reject the null hypothesis that the coefficient is 0? What is the interpretation of the</strong> <span class="math inline">\(R^2\)</span> value? Compare the square root of the raw (unadjusted) <span class="math inline">\(R^2\)</span> of your linear model to the correlation between that explanatory variable and the response using the <code>cor()</code> function (e.g.&nbsp;<code>cor(nba_data_2022$INSERT_VARIABLE, nba_data_2022$min_per_game)</code> or <code>cor(heart_disease$INSERT_VARIABLE, heart_disease$log_cost)</code>- but replace <code>INSERT_VARIABLE</code> with your variable). <strong>What do you notice?</strong></p>
<p>To assess the fit of a linear model, we can also plot the predicted values vs the actual values, to see how closely our predictions align with reality, and to decide whether our model is making any systematic errors. Execute the following code chunk to show the actual response values against our model’s predictions</p>
<section id="sports-3" class="level4">
<h4 class="anchored" data-anchor-id="sports-3">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">init_preds =</span> <span class="fu">predict</span>(init_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> init_preds, <span class="at">y =</span> min_per_game)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictions"</span>, <span class="at">y =</span> <span class="st">"Observed minutes / game"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-4" class="level4">
<h4 class="anchored" data-anchor-id="health-4">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(log_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model_preds, <span class="at">y =</span> log_cost)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictions"</span>, <span class="at">y =</span> <span class="st">"Observed log(Cost + 1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="repeat-steps-2-and-3-above-for-each-of-the-different-continuous-variables" class="level3">
<h3 class="anchored" data-anchor-id="repeat-steps-2-and-3-above-for-each-of-the-different-continuous-variables">4. <strong>Repeat steps 2 and 3 above for each of the different continuous variables</strong></h3>
<p>Which of the variables do you think is the most appropriate variable for modeling the minutes per game?</p>
</section>
<section id="include-multiple-covariates-in-your-regression" class="level3">
<h3 class="anchored" data-anchor-id="include-multiple-covariates-in-your-regression">5. <strong>Include multiple covariates in your regression</strong></h3>
<p>Repeat steps 2 and 3 above but including more than one variable in your model. You can easily do this in the <code>lm()</code> function by adding another variable to the formula with the <code>+</code> operator as so (but just replace the <code>INSERT_VARIABLE_X</code> parts):</p>
<section id="sports-4" class="level4">
<h4 class="anchored" data-anchor-id="sports-4">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>multi_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> INSERT_VARIABLE_1 <span class="sc">+</span> INSERT_VARIABLE_2, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> nba_data_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-5" class="level4">
<h4 class="anchored" data-anchor-id="health-5">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>multi_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> INSERT_VARIABLE_1 <span class="sc">+</span> INSERT_VARIABLE_2, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Experiment with different sets of the continuous variables</strong>. What sets of continuous variables do you think model minutes per game best? (Remember to use the <strong>Adjusted</strong> <span class="math inline">\(R^2\)</span> when comparing models that have different numbers of variables).</p>
<p>Beware collinearity! Load the <code>car</code> library (install it if necessary!) and use the <code>vif()</code> function to check for possible (multi)collinearity. The <code>vif()</code> function computes the <strong>variance inflation factor (VIF)</strong> where for predictor <span class="math inline">\(x_j\)</span> for <span class="math inline">\(j \in 1,\dots, p\)</span>:</p>
<p><span class="math display">\[
VIF_j = \frac{1}{1 - R^2_j}
\]</span> where <span class="math inline">\(R^2_j\)</span> is the <span class="math inline">\(R^2\)</span> from a variable with variable <span class="math inline">\(x_j\)</span> as the response and the other <span class="math inline">\(p-1\)</span> predictors as the explanatory variables. VIF values close to 1 indicate the variable is not correlated with other predictors, while VIF values over 5 indicate strong presence of collinearity. If present, remove a variable with VIF over 5, and redo the fit. Rinse, lather, and repeat until the <code>vif()</code> outputs are all less than 5. The follow code chunk displays an example of using this function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by uncommenting out the following line:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("car")</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (SPORTS)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(multi_nba_lm)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># (HEALTH)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(multi_cost_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="linear-model-with-one-categorical-variable" class="level3">
<h3 class="anchored" data-anchor-id="linear-model-with-one-categorical-variable">6. Linear model with one categorical variable</h3>
<p>Now we will start to deal with the discrete variables in our dataset, allowing for different kinds of models.</p>
<section id="sports-5" class="level4">
<h4 class="anchored" data-anchor-id="sports-5">(SPORTS)</h4>
<p>Run the following code to fit a model using only the <code>position</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pos_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position, <span class="at">data =</span> nba_data_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, use the following code to first create a column called <code>pos_preds</code> containing the predictions of the model above, to display the predictions of this model against the actual observed minutes / game, but <code>facet</code> by the player’s position:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos_preds =</span> <span class="fu">predict</span>(pos_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_per_game, <span class="at">y =</span> pos_preds)) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> position, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual minutes / game"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted minutes / game"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As shown in the figure above, categorical variables make it <strong>so we are changing the intercept of our regression line</strong>. To make this more clear, view the output of the summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pos_nba_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-6" class="level4">
<h4 class="anchored" data-anchor-id="health-6">(HEALTH)</h4>
<p>Run the following code to fit a model using only the <code>Gender</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gender_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender, <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, use the following code to first create a column called <code>model_preds</code> containing the predictions of the model above, to display the predictions of this model against the actual <code>log_cast</code>, but <code>facet</code> by the patient’s <code>Gender</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(gender_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_cost, <span class="at">y =</span> model_preds)) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual log(Cost + 1)"</span>, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted log(Cost + 1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As shown in the figure above, categorical variables make it <strong>so we are changing the intercept of our regression line</strong>. To make this more clear, view the output of the summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gender_cost_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-together-now-1" class="level4">
<h4 class="anchored" data-anchor-id="all-together-now-1">(ALL TOGETHER NOW)</h4>
<p><strong>Notice how only four coefficients are provided in addition to the intercept.</strong> This is because, by default, <code>R</code> turns the categorical variables of <span class="math inline">\(m\)</span> levels (e.g.&nbsp;there are 5 positions in the NBA dataset, and there are 2 genders in the heart disease dataset) into <span class="math inline">\(m - 1\)</span> indicator variables (binary with values of 1 if in that level versus 0 if not that level) for different categories relative to a <strong>baseline level</strong>.</p>
<p>For the (SPORTS) group, <code>R</code> has created an indicator for four positions: PF, PG, SF, and SG. By default, <code>R</code> will use alphabetical order to determine the baseline category, which in this example the center position C.</p>
<p>In the (HEALTH) example, we end up with an indicator for <code>Male</code> because <code>R</code> has chosen <code>Female</code> as the baseline category, since it comes first in alphabetical order.</p>
<p>The values for the coefficient estimates indicate the expected change in the response variable relative to the baseline. In other words, <strong>the intercept term gives us the baseline’s average y</strong>, e.g.&nbsp;the average minutes / game for centers, or average log(<code>Cost</code>) for male patients. This matches what you displayed in the predictions against observed response scatterplots by position above.</p>
<p><strong>Beware the default baseline <code>R</code> picks for categorical variables!</strong> We typically want to choose the baseline level to be the group <strong>with the most observations</strong>.</p>
</section>
<section id="sports-6" class="level4">
<h4 class="anchored" data-anchor-id="sports-6">(SPORTS)</h4>
<p>In this example, each position has a similar number of observations so the results are reasonable. But in general, we can change the reference level by modifying the <code>factor</code> levels of the categorical variables (similar to how we reorder things in <code>ggplot2</code>). For example, after viewing <code>table(nba_data_2022$position)</code> we see how the SG position has the most observations. We can use the following code to modify the position variable so that SG is the baseline (we use <code>fct_relevel()</code> to update <code>position</code> so that SG is the first factor level - and we do not need to modify the order of the remaining levels):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">fct_relevel</span>(position, <span class="st">"SG"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Refit the linear regression model using <code>position</code> above, how has the summary changed?</strong></p>
</section>
<section id="health-7" class="level4">
<h4 class="anchored" data-anchor-id="health-7">(HEALTH)</h4>
<p>In this example, <code>Female</code> has the most number of observations so the default was appropriate. But in general, we can change the reference level by modifying the <code>factor</code> levels of the categorical variables (similar to how we reorder things in <code>ggplot2</code>). For example, we can use the following code to modify the <code>Gender</code> variable so that <code>Male</code> is the baseline (we use <code>fct_relevel()</code> to update <code>Gender</code> so that <code>Male</code> is the first factor level - and we do not need to modify the order of the remaining levels):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">fct_relevel</span>(Gender, <span class="st">"Male"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Refit the linear regression model using <code>Gender</code> above, how has the summary changed?</strong></p>
<p>After you refit the model above, change the reference level back to <code>Female</code> witht the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">fct_relevel</span>(Gender, <span class="st">"Female"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="linear-model-with-one-categorical-and-one-continuous-variable" class="level3">
<h3 class="anchored" data-anchor-id="linear-model-with-one-categorical-and-one-continuous-variable">7. Linear model with one categorical AND one continuous variable</h3>
<p>Pick a single continuous variable from earlier, use it to replace INSERT_VARIABLE below, then run the code to fit a model with your categorical variable included:</p>
<section id="sports-7" class="level4">
<h4 class="anchored" data-anchor-id="sports-7">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>x_pos_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position <span class="sc">+</span> INSERT_VARIABLE, <span class="at">data =</span> nba_data_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Create scatterplots with your predictions on the y-axis, your INSERT_VARIABLE on the x-asis, and color by position</strong>. What do you observe?</p>
<p>Given similarities between different types of positions, we can easily collapse the positions together into a smaller number of categories using <code>fct_collapse()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position_group =</span> <span class="fu">fct_collapse</span>(position,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Guard =</span> <span class="fu">c</span>(<span class="st">"SG"</span>, <span class="st">"PG"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Forward =</span> <span class="fu">c</span>(<span class="st">"SF"</span>, <span class="st">"PF"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Center =</span> <span class="st">"C"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Refit the model with this new <code>position_group</code> variable</strong>, but assign it to a different name, e.g.&nbsp;<code>x_pos_group_nba_lm</code>. What changed in the summary?</p>
</section>
<section id="health-8" class="level4">
<h4 class="anchored" data-anchor-id="health-8">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x_gender_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender <span class="sc">+</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Create scatterplots with your predictions on the y-axis, your INSERT_VARIABLE on the x-asis, and color by <code>Gender</code></strong>. What do you observe?</p>
<p>Another categorical we have access to is the <code>Drugs</code> variable, which is currently coded as numeric. We can first use the <code>fct_recode()</code> function to modify the <code>Drugs</code> variable so that the integers are relabeled:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Drugs =</span> <span class="fu">fct_recode</span>(<span class="fu">as.factor</span>(Drugs),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"None"</span> <span class="ot">=</span> <span class="st">"0"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"One"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"&gt; One"</span> <span class="ot">=</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the following code to fit a model using only the <code>Drugs</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>drugs_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Drugs, <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Repeat the same from above that you considered for the <code>Gender</code> variable, viewing the predictions facetted by <code>Drugs</code> and assess the <code>summary()</code> output. <strong>Do you think an appropriate reference level was used?</strong> (HINT: Use the <code>table()</code> function on the <code>Drugs</code> variable to view the overall frequency of each level and determine if the most frequent level was used as the reference.)</p>
<p>Given the similar values, we may decide to collapse the level of <code>One</code> and <code>&gt; One</code> into a single level <code>&gt;= One</code>. We can easily collapse the levels together into a smaller number of categories using <code>fct_collapse()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">drugs_group =</span> <span class="fu">fct_collapse</span>(Drugs,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">None =</span> <span class="fu">c</span>(<span class="st">"None"</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">`</span><span class="at">&gt;= One</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"One"</span>, <span class="st">"&gt; One"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Refit the model with this new <code>drugs_group</code> variable</strong>, but assign it to a different name, e.g.&nbsp;<code>drugs_group_cost_lm</code>. What changed in the summary?</p>
</section>
</section>
<section id="interactions" class="level3">
<h3 class="anchored" data-anchor-id="interactions">8. Interactions</h3>
<p>Remember with <code>ggplot2</code> you can directly compute and plot the results from running linear regression using <code>geom_smooth()</code> or <code>stat_smooth()</code> and specifying that <code>method = "lm"</code>. Try running the following code (replace INSERT_VARIABLE!) to generate the linear regression fits with <code>geom_smooth</code> versus your own model’s predictions (note the different <code>y</code> mapping for the point versus smooth layers):</p>
<section id="sports-8" class="level4">
<h4 class="anchored" data-anchor-id="sports-8">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos_preds =</span> <span class="fu">predict</span>(x_pos_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> INSERT_VARIABLE, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> position)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> pos_preds),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> position, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"INSERT YOUR LABEL HERE"</span>, </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted minutes / game"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> min_per_game),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-9" class="level4">
<h4 class="anchored" data-anchor-id="health-9">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(x_gender_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> INSERT_VARIABLE, </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> model_preds),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"INSERT YOUR LABEL HERE"</span>, </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted log(Cost + 1)"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> log_cost),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-together-now-2" class="level4">
<h4 class="anchored" data-anchor-id="all-together-now-2">(ALL TOGETHER NOW)</h4>
<p><strong>The <code>geom_smooth()</code> regression lines do NOT match!</strong> This is because <code>ggplot2</code> is fitting <strong>separate regressions for each value of the categorical variable</strong>, meaning the slope for the continuous variable on the x-axis is changing for each position/gender. We can match the output of the <code>geom_smooth()</code> results with <strong>interactions</strong>. We can use interaction terms to build more complex models. Interaction terms allow for a different linear model to be fit for each category; that is, they allow for different slopes across different categories. If we believe relationships between continuous variables, and outcomes, differ across categories, we can use interaction terms to better model these relationships.</p>
<p>To fit a model with an interaction term between two variables, include the interaction via the <code>*</code> operator like so:</p>
</section>
<section id="sports-9" class="level4">
<h4 class="anchored" data-anchor-id="sports-9">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pos_int_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position <span class="sc">+</span> INSERT_VARIABLE <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                       position <span class="sc">*</span> INSERT_VARIABLE, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> nba_data_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-10" class="level4">
<h4 class="anchored" data-anchor-id="health-10">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>gender_int_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender <span class="sc">+</span> INSERT_VARIABLE <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                       Gender <span class="sc">*</span> INSERT_VARIABLE, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> heart_disease)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-together-now-3" class="level4">
<h4 class="anchored" data-anchor-id="all-together-now-3">(ALL TOGETHER NOW)</h4>
<p><strong>Replace the predictions in the previous plot’s <code>mutate</code> code with this interaction model’s predictions.</strong> How do they compare to the results from <code>geom_smooth()</code> now?</p>
<p>You can model interactions between any type of variables using the <code>*</code> operator, feel free to experiment on your different possible continuous variables.</p>
</section>
</section>
<section id="polynomials" class="level3">
<h3 class="anchored" data-anchor-id="polynomials">9. Polynomials</h3>
<p>Another way to increase the explanatory power of your model is to include transformations of continuous variables. For instance you can directly create a column that is a square of a variable with <code>mutate()</code> and then fit the regression with the original variable and its squared term:</p>
<section id="sports-10" class="level4">
<h4 class="anchored" data-anchor-id="sports-10">(SPORTS)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fg_perc_squared =</span> field_goal_percentage<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>squared_fg_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> field_goal_percentage <span class="sc">+</span> fg_perc_squared, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> nba_data_2022)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(squared_fg_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What are some difficulties with interpreting this model fit?</strong> View the predictions for this model or other covariates you squared.</p>
<p>The <code>poly()</code> function allows us to build higher-order polynomial transformations of variables easily. Run the following code chunk to fit a 9th-order polynomial model (i.e.&nbsp;<span class="math inline">\(Y = \beta_0 + \beta_1x + \beta_2x^2 + \ldots + \beta_9x^9\)</span>) between minutes / game and field goal percentage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>poly_nine_fg_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">9</span>), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> nba_data_2022)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_nine_fg_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do you think this is appropriate, how did this change your predictions compared to the previous plot or when only using the variable without any transformation?</strong></p>
</section>
<section id="health-11" class="level4">
<h4 class="anchored" data-anchor-id="health-11">(HEALTH)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration_squared =</span> Duration<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>squared_duration_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Duration <span class="sc">+</span> duration_squared, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> heart_disease)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(squared_duration_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What are some difficulties with interpreting this model fit?</strong> View the predictions for this model or other covariates you squared.</p>
<p>The <code>poly()</code> function allows us to build higher-order polynomial transformations of variables easily. Run the following code chunk to fit a 9th-order polynomial model (i.e.&nbsp;<span class="math inline">\(Y = \beta_0 + \beta_1x + \beta_2x^2 + \ldots + \beta_9x^9\)</span>) between <code>log_cost</code> and <code>Duration</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>poly_nine_duration_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">9</span>), </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> heart_disease)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_nine_duration_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do you think this is appropriate, how did this change your predictions compared to the previous plot or when only using the variable without any transformation?</strong></p>
</section>
</section>
<section id="training-and-testing" class="level3">
<h3 class="anchored" data-anchor-id="training-and-testing">10. Training and testing</h3>
<p>As we’ve seen, using transformations such as higher-order polynomials may decrease the interpretability and increase the potential for overfitting associated with our models; however, they can also dramatically improve the explanatory power.</p>
<p>We need a way for making sure our more complicated models have not overly fit to the noise present in our data. Another way of saying this is that a good model should generalize to a different sample than the one on which it was fit. This intuition motivates the idea of training/testing. We split our data into two parts, use one part – the training set – to fit our models, and the other part – the testing set – to evaluate our models. Any model which happens to fit to the noise present in our training data should perform poorly on our testing data.</p>
<p>NOTE: We split our data randomly using the <code>sample()</code> function, which means that each time you run this code you’ll get a different result… UNLESS you set a seed. This makes the code reproducible, as the seed starts the (pseudo)random number generator. Always remember to <code>set.seed()</code> any time your methods involve randomness. Feel free to use any numbers you like (Prof.&nbsp;Yurko generally uses the years that the Pittsburgh Pirates won the world series, but you do whatever you like).</p>
<section id="sports-11" class="level4">
<h4 class="anchored" data-anchor-id="sports-11">(SPORTS)</h4>
<p>The first thing we will need to do is split our sample. Run the following code chunk to divide our data into two halves, which we will refer to as a training set and a test set. Briefly summarize what each line in the code chunk is doing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>) <span class="co"># CHANGE THIS NUMBER</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>n_players <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nba_data_2022)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>train_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(n_players, n_players <span class="sc">/</span> <span class="dv">2</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>test_i <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>n_players)[<span class="sc">-</span>train_i]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>nba_train <span class="ot">&lt;-</span> nba_data_2022[train_i,]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>nba_test <span class="ot">&lt;-</span> nba_data_2022[test_i,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now compare three candidate models for predicting minutes played using position and field goal percentage. We will fit these models on the <strong>training data</strong> only, ignoring the testing data for the moment. Run the below two code chunks to create two candidate models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>candidate_model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>) <span class="sc">+</span> position <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                          position <span class="sc">*</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>), </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> nba_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>candidate_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>) <span class="sc">+</span> position, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> nba_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>summary()</code>, which of these models has more explanatory power according to the training data? Which of the models is less likely to overfit?</p>
<p><strong>Fit another model to predict minutes / game using a different set of variables / polynomials</strong>.</p>
<p>Now that we’ve built our candidate models, we will evaluate them on our test set, using the criterion of mean squared error (MSE). Run the following code chunk to compute, on the test set, the MSE of predictions given by the first model compared to the actual minutes played.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model_1_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(candidate_model_1, <span class="at">newdata =</span> nba_test)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>model_1_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((model_1_preds <span class="sc">-</span> nba_test<span class="sc">$</span>min_per_game)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do this for each of your candidate models</strong>. Compare the MSE on the test set, which model performed best (lowest test MSE)?</p>
</section>
<section id="health-12" class="level4">
<h4 class="anchored" data-anchor-id="health-12">(HEALTH)</h4>
<p>The first thing we will need to do is split our sample. Run the following code chunk to divide our data into two halves, which we will refer to as a training set and a test set. Briefly summarize what each line in the code chunk is doing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>) <span class="co"># CHANGE THIS NUMBER</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>n_patients <span class="ot">&lt;-</span> <span class="fu">nrow</span>(heart_disease)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>train_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(n_patients, n_patients <span class="sc">/</span> <span class="dv">2</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>test_i <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>n_patients)[<span class="sc">-</span>train_i]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>heart_train <span class="ot">&lt;-</span> heart_disease[train_i,]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>heart_test <span class="ot">&lt;-</span> heart_disease[test_i,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now compare three candidate models for predicting <code>log_cost</code> using <code>Gender</code> and <code>Duration</code>. We will fit these models on the <strong>training data</strong> only, ignoring the testing data for the moment. Run the below two code chunks to create two candidate models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>candidate_model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>) <span class="sc">+</span> Gender <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                          Gender <span class="sc">*</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>), </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> heart_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>candidate_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>) <span class="sc">+</span> Gender, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> heart_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>summary()</code>, which of these models has more explanatory power according to the training data? Which of the models is less likely to overfit?</p>
<p><strong>Fit another model to predict <code>log_cost</code> using a different set of variables / polynomials</strong>.</p>
<p>Now that we’ve built our candidate models, we will evaluate them on our test set, using the criterion of mean squared error (MSE). Run the following code chunk to compute, on the test set, the MSE of predictions given by the first model compared to the actual <code>log_cost</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model_1_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(candidate_model_1, <span class="at">newdata =</span> heart_test)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>model_1_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((model_1_preds <span class="sc">-</span> heart_test<span class="sc">$</span>log_cost)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Do this for each of your candidate models</strong>. Compare the MSE on the test set, which model performed best (lowest test MSE)?</p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb48" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Linear Regression"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "June 26, 2023"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: false</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: none</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goals</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>We will briefly review linear modeling, focusing on building and assessing linear models in R. We have four main goals in this lab:</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>use exploratory data analysis (EDA) and visualization to determine a) whether two variables have a linear relationship, and b) among a set of explanatory variables, which one(s) seem like the best candidates for predicting a given output variable.</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>fit and interpret simple regression models,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>look at diagnostic plots to determine whether a linear model is a good fit for our data,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>assess our fitted linear models.</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>Execute the following code chunk to (a) load the necessary data for this lab, (b) compute four variables we will use in this lab, (c) remove players with missing data (just to simplify things), and (d) subset out players with low minute totals (fewer than 250 minutes played in a season):</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, warning = FALSE, message = FALSE}</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.stat.cmu.edu/cmsac/sure/2022/materials/data/sports/intro_r/nba_2022_player_stats.csv"</span>)</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize player stats across multiple teams they played for:</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(player) <span class="sc">%&gt;%</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">age =</span> <span class="fu">first</span>(age),</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">first</span>(position),</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">games =</span> <span class="fu">sum</span>(games, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">minutes_played =</span> <span class="fu">sum</span>(minutes_played, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">field_goals =</span> <span class="fu">sum</span>(field_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">field_goal_attempts =</span> <span class="fu">sum</span>(field_goal_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">three_pointers =</span> <span class="fu">sum</span>(three_pointers, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">three_point_attempts =</span> <span class="fu">sum</span>(three_point_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">free_throws =</span> <span class="fu">sum</span>(free_throws, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">free_throw_attempts =</span> <span class="fu">sum</span>(free_throw_attempts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">field_goal_percentage =</span> field_goals <span class="sc">/</span> field_goal_attempts,</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">three_point_percentage =</span> three_pointers <span class="sc">/</span> three_point_attempts,</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">free_throw_percentage =</span> free_throws <span class="sc">/</span> free_throw_attempts,</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">min_per_game =</span> minutes_played <span class="sc">/</span> games) <span class="sc">%&gt;%</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows with missing missing values</span></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(minutes_played <span class="sc">&gt;</span> <span class="dv">250</span>)</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Which players play the most minutes / game?</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>In the National Basketball Association (NBA), and more generally in team sports, a coach must make decisions about how many minutes each player should play. Typically, these decisions are informed by a player's skills, along with other factors such as fatigue, matchups, etc. Our goal is to use measurements of a few (quantifiable) player attributes to predict the minutes per game a player plays. In particular, we will focus on the following data, measured over the 2022 NBA regular season for over 400 players:</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`player`</span>: names of each player (not useful for modeling purposes, but just for reference)</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`min_per_game`</span>: our **response variable**, measuring the minutes per game a player played during the 2022 NBA regular season.</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`field_goal_percentage`</span>: potential (continuous) **explanatory variable**, calculated as (number of made field goals) / (number of field goals attempted).</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`free_throw_percentage`</span>: potential (continuous) **explanatory variable**, calculated as (number of made free throws) / (number of free throws attempted).</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`three_point_percentage`</span>: potential (continuous) **explanatory variable**, calculated as (number of made 3 point shots) / (number of 3 point shots attempted),</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`age`</span>: potential (continuous / discrete) **explanatory variable**, player's reported age for the 2022 season,</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`position`</span>: potential (categorical) explanatory variable, one of <span class="in">`SG`</span> (shooting guard), <span class="in">`PG`</span> (point guard), <span class="in">`C`</span> (center), <span class="in">`PF`</span> (power forward) or <span class="in">`SF`</span> (small forward).</span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>Execute the following code chunk to load the heart disease dataset we worked with before:</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r init_data, warning = FALSE, message = FALSE}</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"http://www.stat.cmu.edu/cmsac/sure/2022/materials/data/health/intro_r/heart_disease.csv"</span>)</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a>This dataset consists of 788 heart disease patients (608 women, 180 men). Your goal is to predict the <span class="in">`Cost`</span> column, which corresponds to the patient's total cost of claims by subscriber (i.e., <span class="in">`Cost`</span> is the response variable). You have access to the following explanatory variables:</span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Age`</span>: Age of subscriber (years)</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Gender`</span>: Gender of subscriber</span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Interventions`</span>: Total number of interventions or procedures carried out</span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Drugs`</span>: Categorized number of drugs prescribed: 0 if none, 1 if one, 2 if more than one</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`ERVisit`</span>: Number of emergency room visits</span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Complications`</span>: Whether or not the subscriber had complications: 1 if yes, 0 if no</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Comorbidities`</span>: Number of other diseases that the subscriber had</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Duration`</span>: Number of days of duration of treatment condition</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. **EDA**</span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a>Spend time exploring the dataset, to visually assess which of the **explanatory** variables listed above is most associated with our response: the minutes played per game (`min_per_game`) for (SPORTS), or `Cost` for (HEALTH). Create scatterplots between the response and each continuous explanatory variable. **Do any of the relationship appear to be linear?** Describe the direction and strength of the association between the explanatory and response variables.</span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>In your opinion, **which of the possible continuous explanatory variables displays the strongest relationship with our response variable**?</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>Create an appropriate visualization comparing the distribution of minutes per game *by position*.</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a>**Do you think there is a relationship between minutes per game and position?**</span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a>Create an appropriate visualization comparing the distribution of cost *by gender*.</span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-121"><a href="#cb48-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-122"><a href="#cb48-122" aria-hidden="true" tabindex="-1"></a><span class="co"># INSERT CODE HERE</span></span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a>**Do you think there is a relationship between cost and gender?**</span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-127"><a href="#cb48-127" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. **Fit a simple linear model**</span></span>
<span id="cb48-128"><a href="#cb48-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a>Now that you've performed some EDA, it's time to actually fit some linear models to the data. Start the variable you think displays the strongest relationship with the response variable. **Update the following code by replacing INSERT_VARIABLE with your selected variable, and run to fit the model**:</span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-134"><a href="#cb48-134" aria-hidden="true" tabindex="-1"></a>init_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-135"><a href="#cb48-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a>Before checking out the <span class="in">`summary()`</span> of this model, **you need to check the diagnostics** to see if it meets the necessary assumptions. To do this you can try running <span class="in">`plot(init_nba_lm)`</span> in the console (what happens?). Equivalently, another way to make the same plots but with <span class="in">`ggplot2`</span> perks is with the <span class="co">[</span><span class="ot">`ggfortify`</span><span class="co">](https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_lm.html)</span> package by running the following code:</span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by running the following line (uncomment it!) in the console</span></span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggfortify")</span></span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(init_nba_lm) <span class="sc">+</span></span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a>init_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Cost <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a>Before check out the <span class="in">`summary()`</span> of this model, **you need to check the diagnostics** to see if it meets the necessary assumptions. To do this you can try running <span class="in">`plot(init_cost_lm)`</span> in the console (what happens?). Equivalently, another way to make the same plots but with <span class="in">`ggplot2`</span> perks is with the <span class="co">[</span><span class="ot">`ggfortify`</span><span class="co">](https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_lm.html)</span> package by running the following code:</span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by running the following line (uncomment it!) in the console</span></span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggfortify")</span></span>
<span id="cb48-158"><a href="#cb48-158" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb48-159"><a href="#cb48-159" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(init_cost_lm) <span class="sc">+</span></span>
<span id="cb48-160"><a href="#cb48-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb48-161"><a href="#cb48-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-162"><a href="#cb48-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-163"><a href="#cb48-163" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (ALL TOGETHER NOW)</span></span>
<span id="cb48-164"><a href="#cb48-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-165"><a href="#cb48-165" aria-hidden="true" tabindex="-1"></a>The first plot is **residuals vs. fitted**: this plot should NOT display any clear patterns in the data, no obvious outliers, and be symmetric around the horizontal line at zero. The smooth line provided is just for reference to see how the residual average changes. **Do you see any obvious patterns in your plot for this model?**</span>
<span id="cb48-166"><a href="#cb48-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-167"><a href="#cb48-167" aria-hidden="true" tabindex="-1"></a>The second plot is a <span class="co">[</span><span class="ot">Q-Q plot</span><span class="co">](http://www.stat.cmu.edu/~cshalizi/TALR/TALR.pdf)</span> (p. 93). Without getting too much into the math behind them, **the closer the observations are to the dashed reference line, the better your model fit is.** It is bad for the observations to diverge from the dashed line in a systematic way - that means we are violating the assumption of normality discussed in lecture. **How do your points look relative to the dashed reference line?**</span>
<span id="cb48-168"><a href="#cb48-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-169"><a href="#cb48-169" aria-hidden="true" tabindex="-1"></a>The third plot looks at the square root of the absolute value of the standardized residiuals. We want to check for homoskedascity of errors (equal, constant variance). **If we did have constant variance, what would we expect to see?** **What does your plot look like?**</span>
<span id="cb48-170"><a href="#cb48-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-171"><a href="#cb48-171" aria-hidden="true" tabindex="-1"></a>The fourth plot is residuals vs. leverage which helps us identify **influential** points. **Leverage** quanitifies the influence the observed response for a particular observation has on its predicted value, i.e. if the leverage is small then the observed response has a small role in the value of its predicted reponse, while a large leverage indicates the observed response plays a large role in the predicted response. Its a value between 0 and 1, where the sum of all leverage values equals the number of coefficients (including the intercept). Specifically the leverage for observation $i$ is computed as:</span>
<span id="cb48-172"><a href="#cb48-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-173"><a href="#cb48-173" aria-hidden="true" tabindex="-1"></a>$$h_{ii} = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\sum_i^n (x_i - \bar{x})^2}$$ where $\bar{x}$ is the average value for variable $x$ across all observations. <span class="co">[</span><span class="ot">See page 191 for more details on leverage and the regression hat matrix</span><span class="co">](http://www.stat.cmu.edu/~cshalizi/TALR/TALR.pdf)</span>. We're looking for points in the upper right or lower right corners, where dashed lines for <span class="co">[</span><span class="ot">Cook's distance</span><span class="co">](https://en.wikipedia.org/wiki/Cook%27s_distance)</span> values would indicate potential outlier points that are displaying too much influence on the model results. **Do you observed any such influential points in upper or lower right corners?**</span>
<span id="cb48-174"><a href="#cb48-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-175"><a href="#cb48-175" aria-hidden="true" tabindex="-1"></a>**What is your final assessment of the diagnostics, do you believe all assumptions are met? Any potential outlier observations to remove?**</span>
<span id="cb48-176"><a href="#cb48-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-177"><a href="#cb48-177" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-178"><a href="#cb48-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-179"><a href="#cb48-179" aria-hidden="true" tabindex="-1"></a>**SPOILER ALERT** An obvious result from looking at the residual diagnostics above is that we are clearly violating the assumption of Normality. **Why do you think we're violating this assumption?** (HINT: Display a histogram of the <span class="in">`Cost`</span> variable.)</span>
<span id="cb48-180"><a href="#cb48-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-181"><a href="#cb48-181" aria-hidden="true" tabindex="-1"></a>One way of addressing this concern is to apply a transformation to the response variable, in this case <span class="in">`Cost`</span>. A common transformation for any type of dollar amount is to use the <span class="in">`log()`</span> transformation. Run the following code chunk to create a new <span class="in">`log_cost`</span> variable that we will use for the remainder of the lab.</span>
<span id="cb48-182"><a href="#cb48-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-183"><a href="#cb48-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-184"><a href="#cb48-184" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-185"><a href="#cb48-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_cost =</span> <span class="fu">log</span>(Cost <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb48-186"><a href="#cb48-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-187"><a href="#cb48-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-188"><a href="#cb48-188" aria-hidden="true" tabindex="-1"></a>**Why did we need to `+ 1` before taking the `log()`?** (HINT: Look at the minimum of <span class="in">`Cost`</span>.) Now make another histogram, this time for the new <span class="in">`log_cost`</span> variable - what happened to the distribution?</span>
<span id="cb48-189"><a href="#cb48-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-190"><a href="#cb48-190" aria-hidden="true" tabindex="-1"></a>Now fit the same model as before using the following code chunk. __Update the following code by replacing INSERT_VARIABLE with your selected variable, and run to fit the model__:</span>
<span id="cb48-191"><a href="#cb48-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-192"><a href="#cb48-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-193"><a href="#cb48-193" aria-hidden="true" tabindex="-1"></a>log_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span>
<span id="cb48-194"><a href="#cb48-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-195"><a href="#cb48-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-196"><a href="#cb48-196" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. **Assess the model summary**</span></span>
<span id="cb48-197"><a href="#cb48-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-198"><a href="#cb48-198" aria-hidden="true" tabindex="-1"></a>Following the example in lecture, interpret the results from the <span class="in">`summary()`</span> function on your initial model. **Do you think there is sufficient evidence to reject the null hypothesis that the coefficient is 0? What is the interpretation of the** $R^2$ value? Compare the square root of the raw (unadjusted) $R^2$ of your linear model to the correlation between that explanatory variable and the response using the `cor()` function (e.g. `cor(nba_data_2022$INSERT_VARIABLE, nba_data_2022$min_per_game)` or `cor(heart_disease$INSERT_VARIABLE, heart_disease$log_cost)`- but replace `INSERT_VARIABLE` with your variable). **What do you notice?**</span>
<span id="cb48-199"><a href="#cb48-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-200"><a href="#cb48-200" aria-hidden="true" tabindex="-1"></a>To assess the fit of a linear model, we can also plot the predicted values vs the actual values, to see how closely our predictions align with reality, and to decide whether our model is making any systematic errors. Execute the following code chunk to show the actual response values against our model's predictions</span>
<span id="cb48-201"><a href="#cb48-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-202"><a href="#cb48-202" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-203"><a href="#cb48-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-204"><a href="#cb48-204" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-205"><a href="#cb48-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">init_preds =</span> <span class="fu">predict</span>(init_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-206"><a href="#cb48-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> init_preds, <span class="at">y =</span> min_per_game)) <span class="sc">+</span></span>
<span id="cb48-207"><a href="#cb48-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb48-208"><a href="#cb48-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb48-209"><a href="#cb48-209" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb48-210"><a href="#cb48-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-211"><a href="#cb48-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictions"</span>, <span class="at">y =</span> <span class="st">"Observed minutes / game"</span>)</span>
<span id="cb48-212"><a href="#cb48-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-213"><a href="#cb48-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-214"><a href="#cb48-214" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-215"><a href="#cb48-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-216"><a href="#cb48-216" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-217"><a href="#cb48-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(log_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-218"><a href="#cb48-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model_preds, <span class="at">y =</span> log_cost)) <span class="sc">+</span></span>
<span id="cb48-219"><a href="#cb48-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb48-220"><a href="#cb48-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb48-221"><a href="#cb48-221" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb48-222"><a href="#cb48-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-223"><a href="#cb48-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictions"</span>, <span class="at">y =</span> <span class="st">"Observed log(Cost + 1)"</span>)</span>
<span id="cb48-224"><a href="#cb48-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-225"><a href="#cb48-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-226"><a href="#cb48-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. **Repeat steps 2 and 3 above for each of the different continuous variables**</span></span>
<span id="cb48-227"><a href="#cb48-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-228"><a href="#cb48-228" aria-hidden="true" tabindex="-1"></a>Which of the variables do you think is the most appropriate variable for modeling the minutes per game?</span>
<span id="cb48-229"><a href="#cb48-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-230"><a href="#cb48-230" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. **Include multiple covariates in your regression**</span></span>
<span id="cb48-231"><a href="#cb48-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-232"><a href="#cb48-232" aria-hidden="true" tabindex="-1"></a>Repeat steps 2 and 3 above but including more than one variable in your model. You can easily do this in the <span class="in">`lm()`</span> function by adding another variable to the formula with the <span class="in">`+`</span> operator as so (but just replace the <span class="in">`INSERT_VARIABLE_X`</span> parts):</span>
<span id="cb48-233"><a href="#cb48-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-234"><a href="#cb48-234" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-235"><a href="#cb48-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-236"><a href="#cb48-236" aria-hidden="true" tabindex="-1"></a>multi_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> INSERT_VARIABLE_1 <span class="sc">+</span> INSERT_VARIABLE_2, </span>
<span id="cb48-237"><a href="#cb48-237" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-238"><a href="#cb48-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-239"><a href="#cb48-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-240"><a href="#cb48-240" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-241"><a href="#cb48-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-242"><a href="#cb48-242" aria-hidden="true" tabindex="-1"></a>multi_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> INSERT_VARIABLE_1 <span class="sc">+</span> INSERT_VARIABLE_2, </span>
<span id="cb48-243"><a href="#cb48-243" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> heart_disease)</span>
<span id="cb48-244"><a href="#cb48-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-245"><a href="#cb48-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-246"><a href="#cb48-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-247"><a href="#cb48-247" aria-hidden="true" tabindex="-1"></a>**Experiment with different sets of the continuous variables**. What sets of continuous variables do you think model minutes per game best? (Remember to use the **Adjusted** $R^2$ when comparing models that have different numbers of variables).</span>
<span id="cb48-248"><a href="#cb48-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-249"><a href="#cb48-249" aria-hidden="true" tabindex="-1"></a>Beware collinearity! Load the <span class="in">`car`</span> library (install it if necessary!) and use the <span class="in">`vif()`</span> function to check for possible (multi)collinearity. The <span class="in">`vif()`</span> function computes the **variance inflation factor (VIF)** where for predictor $x_j$ for $j \in 1,\dots, p$:</span>
<span id="cb48-250"><a href="#cb48-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-251"><a href="#cb48-251" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-252"><a href="#cb48-252" aria-hidden="true" tabindex="-1"></a>VIF_j = \frac{1}{1 - R^2_j}</span>
<span id="cb48-253"><a href="#cb48-253" aria-hidden="true" tabindex="-1"></a>$$ where $R^2_j$ is the $R^2$ from a variable with variable $x_j$ as the response and the other $p-1$ predictors as the explanatory variables. VIF values close to 1 indicate the variable is not correlated with other predictors, while VIF values over 5 indicate strong presence of collinearity. If present, remove a variable with VIF over 5, and redo the fit. Rinse, lather, and repeat until the <span class="in">`vif()`</span> outputs are all less than 5. The follow code chunk displays an example of using this function:</span>
<span id="cb48-254"><a href="#cb48-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-255"><a href="#cb48-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r vif, eval = FALSE}</span></span>
<span id="cb48-256"><a href="#cb48-256" aria-hidden="true" tabindex="-1"></a><span class="co"># First install the package by uncommenting out the following line:</span></span>
<span id="cb48-257"><a href="#cb48-257" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("car")</span></span>
<span id="cb48-258"><a href="#cb48-258" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb48-259"><a href="#cb48-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-260"><a href="#cb48-260" aria-hidden="true" tabindex="-1"></a><span class="co"># (SPORTS)</span></span>
<span id="cb48-261"><a href="#cb48-261" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(multi_nba_lm)</span>
<span id="cb48-262"><a href="#cb48-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-263"><a href="#cb48-263" aria-hidden="true" tabindex="-1"></a><span class="co"># (HEALTH)</span></span>
<span id="cb48-264"><a href="#cb48-264" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(multi_cost_lm)</span>
<span id="cb48-265"><a href="#cb48-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-266"><a href="#cb48-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-267"><a href="#cb48-267" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6. Linear model with one categorical variable</span></span>
<span id="cb48-268"><a href="#cb48-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-269"><a href="#cb48-269" aria-hidden="true" tabindex="-1"></a>Now we will start to deal with the discrete variables in our dataset, allowing for different kinds of models.</span>
<span id="cb48-270"><a href="#cb48-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-271"><a href="#cb48-271" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-272"><a href="#cb48-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-273"><a href="#cb48-273" aria-hidden="true" tabindex="-1"></a>Run the following code to fit a model using only the <span class="in">`position`</span> variable:</span>
<span id="cb48-274"><a href="#cb48-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-275"><a href="#cb48-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-276"><a href="#cb48-276" aria-hidden="true" tabindex="-1"></a>pos_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position, <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-277"><a href="#cb48-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-278"><a href="#cb48-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-279"><a href="#cb48-279" aria-hidden="true" tabindex="-1"></a>Next, use the following code to first create a column called <span class="in">`pos_preds`</span> containing the predictions of the model above, to display the predictions of this model against the actual observed minutes / game, but <span class="in">`facet`</span> by the player's position:</span>
<span id="cb48-280"><a href="#cb48-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-281"><a href="#cb48-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-282"><a href="#cb48-282" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-283"><a href="#cb48-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos_preds =</span> <span class="fu">predict</span>(pos_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-284"><a href="#cb48-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_per_game, <span class="at">y =</span> pos_preds)) <span class="sc">+</span></span>
<span id="cb48-285"><a href="#cb48-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb48-286"><a href="#cb48-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> position, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb48-287"><a href="#cb48-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-288"><a href="#cb48-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual minutes / game"</span>, </span>
<span id="cb48-289"><a href="#cb48-289" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted minutes / game"</span>)</span>
<span id="cb48-290"><a href="#cb48-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-291"><a href="#cb48-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-292"><a href="#cb48-292" aria-hidden="true" tabindex="-1"></a>As shown in the figure above, categorical variables make it __so we are changing the intercept of our regression line__. To make this more clear, view the output of the summary:</span>
<span id="cb48-293"><a href="#cb48-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-294"><a href="#cb48-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-295"><a href="#cb48-295" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pos_nba_lm)</span>
<span id="cb48-296"><a href="#cb48-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-297"><a href="#cb48-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-298"><a href="#cb48-298" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-299"><a href="#cb48-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-300"><a href="#cb48-300" aria-hidden="true" tabindex="-1"></a>Run the following code to fit a model using only the <span class="in">`Gender`</span> variable:</span>
<span id="cb48-301"><a href="#cb48-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-302"><a href="#cb48-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-303"><a href="#cb48-303" aria-hidden="true" tabindex="-1"></a>gender_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender, <span class="at">data =</span> heart_disease)</span>
<span id="cb48-304"><a href="#cb48-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-305"><a href="#cb48-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-306"><a href="#cb48-306" aria-hidden="true" tabindex="-1"></a>Next, use the following code to first create a column called <span class="in">`model_preds`</span> containing the predictions of the model above, to display the predictions of this model against the actual <span class="in">`log_cast`</span>, but <span class="in">`facet`</span> by the patient's <span class="in">`Gender`</span>:</span>
<span id="cb48-307"><a href="#cb48-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-308"><a href="#cb48-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-309"><a href="#cb48-309" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-310"><a href="#cb48-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(gender_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-311"><a href="#cb48-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_cost, <span class="at">y =</span> model_preds)) <span class="sc">+</span></span>
<span id="cb48-312"><a href="#cb48-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb48-313"><a href="#cb48-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb48-314"><a href="#cb48-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-315"><a href="#cb48-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual log(Cost + 1)"</span>, </span>
<span id="cb48-316"><a href="#cb48-316" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted log(Cost + 1)"</span>)</span>
<span id="cb48-317"><a href="#cb48-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-318"><a href="#cb48-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-319"><a href="#cb48-319" aria-hidden="true" tabindex="-1"></a>As shown in the figure above, categorical variables make it __so we are changing the intercept of our regression line__. To make this more clear, view the output of the summary:</span>
<span id="cb48-320"><a href="#cb48-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-321"><a href="#cb48-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-322"><a href="#cb48-322" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gender_cost_lm)</span>
<span id="cb48-323"><a href="#cb48-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-324"><a href="#cb48-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-325"><a href="#cb48-325" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (ALL TOGETHER NOW)</span></span>
<span id="cb48-326"><a href="#cb48-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-327"><a href="#cb48-327" aria-hidden="true" tabindex="-1"></a>__Notice how only four coefficients are provided in addition to the intercept.__ This is because, by default, `R` turns the categorical variables of $m$ levels (e.g. there are 5 positions in the NBA dataset, and there are 2 genders in the heart disease dataset) into $m - 1$ indicator variables (binary with values of 1 if in that level versus 0 if not that level) for different categories relative to a __baseline level__. </span>
<span id="cb48-328"><a href="#cb48-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-329"><a href="#cb48-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-330"><a href="#cb48-330" aria-hidden="true" tabindex="-1"></a>For the (SPORTS) group, <span class="in">`R`</span> has created an indicator for four positions: PF, PG, SF, and SG. By default, <span class="in">`R`</span> will use alphabetical order to determine the baseline category, which in this example the center position C.</span>
<span id="cb48-331"><a href="#cb48-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-332"><a href="#cb48-332" aria-hidden="true" tabindex="-1"></a>In the (HEALTH) example, we end up with an indicator for <span class="in">`Male`</span> because <span class="in">`R`</span> has chosen <span class="in">`Female`</span> as the baseline category, since it comes first in alphabetical order.  </span>
<span id="cb48-333"><a href="#cb48-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-334"><a href="#cb48-334" aria-hidden="true" tabindex="-1"></a>The values for the coefficient estimates indicate the expected change in the response variable relative to the baseline. In other words, __the intercept term gives us the baseline's average y__, e.g. the average minutes / game for centers, or average log(<span class="in">`Cost`</span>) for male patients. This matches what you displayed in the predictions against observed response scatterplots by position above. </span>
<span id="cb48-335"><a href="#cb48-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-336"><a href="#cb48-336" aria-hidden="true" tabindex="-1"></a>__Beware the default baseline `R` picks for categorical variables!__ We typically want to choose the baseline level to be the group __with the most observations__. </span>
<span id="cb48-337"><a href="#cb48-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-338"><a href="#cb48-338" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-339"><a href="#cb48-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-340"><a href="#cb48-340" aria-hidden="true" tabindex="-1"></a>In this example, each position has a similar number of observations so the results are reasonable. But in general, we can change the reference level by modifying the <span class="in">`factor`</span> levels of the categorical variables (similar to how we reorder things in <span class="in">`ggplot2`</span>). For example, after viewing <span class="in">`table(nba_data_2022$position)`</span> we see how the SG position has the most observations. We can use the following code to modify the position variable so that SG is the baseline (we use <span class="in">`fct_relevel()`</span> to update <span class="in">`position`</span> so that SG is the first factor level - and we do not need to modify the order of the remaining levels):</span>
<span id="cb48-341"><a href="#cb48-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-342"><a href="#cb48-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-343"><a href="#cb48-343" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-344"><a href="#cb48-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">fct_relevel</span>(position, <span class="st">"SG"</span>)) </span>
<span id="cb48-345"><a href="#cb48-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-346"><a href="#cb48-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-347"><a href="#cb48-347" aria-hidden="true" tabindex="-1"></a>__Refit the linear regression model using `position` above, how has the summary changed?__</span>
<span id="cb48-348"><a href="#cb48-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-349"><a href="#cb48-349" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-350"><a href="#cb48-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-351"><a href="#cb48-351" aria-hidden="true" tabindex="-1"></a>In this example, <span class="in">`Female`</span> has the most number of observations so the default was appropriate. But in general, we can change the reference level by modifying the <span class="in">`factor`</span> levels of the categorical variables (similar to how we reorder things in <span class="in">`ggplot2`</span>). For example, we can use the following code to modify the <span class="in">`Gender`</span> variable so that <span class="in">`Male`</span> is the baseline (we use <span class="in">`fct_relevel()`</span> to update <span class="in">`Gender`</span> so that <span class="in">`Male`</span> is the first factor level - and we do not need to modify the order of the remaining levels):</span>
<span id="cb48-352"><a href="#cb48-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-353"><a href="#cb48-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-354"><a href="#cb48-354" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-355"><a href="#cb48-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">fct_relevel</span>(Gender, <span class="st">"Male"</span>)) </span>
<span id="cb48-356"><a href="#cb48-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-357"><a href="#cb48-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-358"><a href="#cb48-358" aria-hidden="true" tabindex="-1"></a>__Refit the linear regression model using `Gender` above, how has the summary changed?__</span>
<span id="cb48-359"><a href="#cb48-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-360"><a href="#cb48-360" aria-hidden="true" tabindex="-1"></a>After you refit the model above, change the reference level back to <span class="in">`Female`</span> witht the following code:</span>
<span id="cb48-361"><a href="#cb48-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-362"><a href="#cb48-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-363"><a href="#cb48-363" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-364"><a href="#cb48-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">fct_relevel</span>(Gender, <span class="st">"Female"</span>)) </span>
<span id="cb48-365"><a href="#cb48-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-366"><a href="#cb48-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-367"><a href="#cb48-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-368"><a href="#cb48-368" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7. Linear model with one categorical AND one continuous variable</span></span>
<span id="cb48-369"><a href="#cb48-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-370"><a href="#cb48-370" aria-hidden="true" tabindex="-1"></a>Pick a single continuous variable from earlier, use it to replace INSERT_VARIABLE below, then run the code to fit a model with your categorical variable included:</span>
<span id="cb48-371"><a href="#cb48-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-372"><a href="#cb48-372" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-373"><a href="#cb48-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-374"><a href="#cb48-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-375"><a href="#cb48-375" aria-hidden="true" tabindex="-1"></a>x_pos_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position <span class="sc">+</span> INSERT_VARIABLE, <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-376"><a href="#cb48-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-377"><a href="#cb48-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-378"><a href="#cb48-378" aria-hidden="true" tabindex="-1"></a>__Create scatterplots with your predictions on the y-axis, your INSERT_VARIABLE on the x-asis, and color by position__. What do you observe?</span>
<span id="cb48-379"><a href="#cb48-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-380"><a href="#cb48-380" aria-hidden="true" tabindex="-1"></a>Given similarities between different types of positions, we can easily collapse the positions together into a smaller number of categories using <span class="in">`fct_collapse()`</span>:</span>
<span id="cb48-381"><a href="#cb48-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-382"><a href="#cb48-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-383"><a href="#cb48-383" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-384"><a href="#cb48-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position_group =</span> <span class="fu">fct_collapse</span>(position,</span>
<span id="cb48-385"><a href="#cb48-385" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Guard =</span> <span class="fu">c</span>(<span class="st">"SG"</span>, <span class="st">"PG"</span>),</span>
<span id="cb48-386"><a href="#cb48-386" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Forward =</span> <span class="fu">c</span>(<span class="st">"SF"</span>, <span class="st">"PF"</span>),</span>
<span id="cb48-387"><a href="#cb48-387" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">Center =</span> <span class="st">"C"</span>)) </span>
<span id="cb48-388"><a href="#cb48-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-389"><a href="#cb48-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-390"><a href="#cb48-390" aria-hidden="true" tabindex="-1"></a>__Refit the model with this new `position_group` variable__, but assign it to a different name, e.g. <span class="in">`x_pos_group_nba_lm`</span>. What changed in the summary?</span>
<span id="cb48-391"><a href="#cb48-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-392"><a href="#cb48-392" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-393"><a href="#cb48-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-394"><a href="#cb48-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-395"><a href="#cb48-395" aria-hidden="true" tabindex="-1"></a>x_gender_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender <span class="sc">+</span> INSERT_VARIABLE, <span class="at">data =</span> heart_disease)</span>
<span id="cb48-396"><a href="#cb48-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-397"><a href="#cb48-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-398"><a href="#cb48-398" aria-hidden="true" tabindex="-1"></a>__Create scatterplots with your predictions on the y-axis, your INSERT_VARIABLE on the x-asis, and color by `Gender`__. What do you observe?</span>
<span id="cb48-399"><a href="#cb48-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-400"><a href="#cb48-400" aria-hidden="true" tabindex="-1"></a>Another categorical we have access to is the <span class="in">`Drugs`</span> variable, which is currently coded as numeric. We can first use the <span class="in">`fct_recode()`</span> function to modify the <span class="in">`Drugs`</span> variable so that the integers are relabeled:</span>
<span id="cb48-401"><a href="#cb48-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-402"><a href="#cb48-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-403"><a href="#cb48-403" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-404"><a href="#cb48-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Drugs =</span> <span class="fu">fct_recode</span>(<span class="fu">as.factor</span>(Drugs),</span>
<span id="cb48-405"><a href="#cb48-405" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"None"</span> <span class="ot">=</span> <span class="st">"0"</span>,</span>
<span id="cb48-406"><a href="#cb48-406" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"One"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb48-407"><a href="#cb48-407" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"&gt; One"</span> <span class="ot">=</span> <span class="st">"2"</span>))</span>
<span id="cb48-408"><a href="#cb48-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-409"><a href="#cb48-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-410"><a href="#cb48-410" aria-hidden="true" tabindex="-1"></a>Run the following code to fit a model using only the <span class="in">`Drugs`</span> variable:</span>
<span id="cb48-411"><a href="#cb48-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-412"><a href="#cb48-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-413"><a href="#cb48-413" aria-hidden="true" tabindex="-1"></a>drugs_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Drugs, <span class="at">data =</span> heart_disease)</span>
<span id="cb48-414"><a href="#cb48-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-415"><a href="#cb48-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-416"><a href="#cb48-416" aria-hidden="true" tabindex="-1"></a>Repeat the same from above that you considered for the <span class="in">`Gender`</span> variable, viewing the predictions facetted by <span class="in">`Drugs`</span> and assess the <span class="in">`summary()`</span> output. __Do you think an appropriate reference level was used?__ (HINT: Use the <span class="in">`table()`</span> function on the <span class="in">`Drugs`</span> variable to view the overall frequency of each level and determine if the most frequent level was used as the reference.)</span>
<span id="cb48-417"><a href="#cb48-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-418"><a href="#cb48-418" aria-hidden="true" tabindex="-1"></a>Given the similar values, we may decide to collapse the level of <span class="in">`One`</span> and <span class="in">`&gt; One`</span> into a single level <span class="in">`&gt;= One`</span>. We can easily collapse the levels together into a smaller number of categories using <span class="in">`fct_collapse()`</span>:</span>
<span id="cb48-419"><a href="#cb48-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-420"><a href="#cb48-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-421"><a href="#cb48-421" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-422"><a href="#cb48-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">drugs_group =</span> <span class="fu">fct_collapse</span>(Drugs,</span>
<span id="cb48-423"><a href="#cb48-423" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">None =</span> <span class="fu">c</span>(<span class="st">"None"</span>),</span>
<span id="cb48-424"><a href="#cb48-424" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">`</span><span class="at">&gt;= One</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"One"</span>, <span class="st">"&gt; One"</span>))) </span>
<span id="cb48-425"><a href="#cb48-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-426"><a href="#cb48-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-427"><a href="#cb48-427" aria-hidden="true" tabindex="-1"></a>__Refit the model with this new `drugs_group` variable__, but assign it to a different name, e.g. <span class="in">`drugs_group_cost_lm`</span>. What changed in the summary?</span>
<span id="cb48-428"><a href="#cb48-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-429"><a href="#cb48-429" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8. Interactions</span></span>
<span id="cb48-430"><a href="#cb48-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-431"><a href="#cb48-431" aria-hidden="true" tabindex="-1"></a>Remember with <span class="in">`ggplot2`</span> you can directly compute and plot the results from running linear regression using <span class="in">`geom_smooth()`</span> or <span class="in">`stat_smooth()`</span> and specifying that <span class="in">`method = "lm"`</span>. Try running the following code (replace INSERT_VARIABLE!) to generate the linear regression fits with <span class="in">`geom_smooth`</span> versus your own model's predictions (note the different <span class="in">`y`</span> mapping for the point versus smooth layers):</span>
<span id="cb48-432"><a href="#cb48-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-433"><a href="#cb48-433" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-434"><a href="#cb48-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-435"><a href="#cb48-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-436"><a href="#cb48-436" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-437"><a href="#cb48-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos_preds =</span> <span class="fu">predict</span>(x_pos_nba_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-438"><a href="#cb48-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> INSERT_VARIABLE, </span>
<span id="cb48-439"><a href="#cb48-439" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> position)) <span class="sc">+</span></span>
<span id="cb48-440"><a href="#cb48-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> pos_preds),</span>
<span id="cb48-441"><a href="#cb48-441" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb48-442"><a href="#cb48-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-443"><a href="#cb48-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> position, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb48-444"><a href="#cb48-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"INSERT YOUR LABEL HERE"</span>, </span>
<span id="cb48-445"><a href="#cb48-445" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted minutes / game"</span>) <span class="sc">+</span></span>
<span id="cb48-446"><a href="#cb48-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> min_per_game),</span>
<span id="cb48-447"><a href="#cb48-447" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>) </span>
<span id="cb48-448"><a href="#cb48-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-449"><a href="#cb48-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-450"><a href="#cb48-450" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-451"><a href="#cb48-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-452"><a href="#cb48-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-453"><a href="#cb48-453" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-454"><a href="#cb48-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_preds =</span> <span class="fu">predict</span>(x_gender_cost_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb48-455"><a href="#cb48-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> INSERT_VARIABLE, </span>
<span id="cb48-456"><a href="#cb48-456" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb48-457"><a href="#cb48-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> model_preds),</span>
<span id="cb48-458"><a href="#cb48-458" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb48-459"><a href="#cb48-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-460"><a href="#cb48-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb48-461"><a href="#cb48-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"INSERT YOUR LABEL HERE"</span>, </span>
<span id="cb48-462"><a href="#cb48-462" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted log(Cost + 1)"</span>) <span class="sc">+</span></span>
<span id="cb48-463"><a href="#cb48-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> log_cost),</span>
<span id="cb48-464"><a href="#cb48-464" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>) </span>
<span id="cb48-465"><a href="#cb48-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-466"><a href="#cb48-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-467"><a href="#cb48-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-468"><a href="#cb48-468" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (ALL TOGETHER NOW)</span></span>
<span id="cb48-469"><a href="#cb48-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-470"><a href="#cb48-470" aria-hidden="true" tabindex="-1"></a>__The `geom_smooth()` regression lines do NOT match!__ This is because `ggplot2` is fitting __separate regressions for each value of the categorical variable__, meaning the slope for the continuous variable on the x-axis is changing for each position/gender. We can match the output of the `geom_smooth()` results with __interactions__. We can use interaction terms to build more complex models. Interaction terms allow for a different linear model to be fit for each category; that is, they allow for different slopes across different categories. If we believe relationships between continuous variables, and outcomes, differ across categories, we can use interaction terms to better model these relationships.</span>
<span id="cb48-471"><a href="#cb48-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-472"><a href="#cb48-472" aria-hidden="true" tabindex="-1"></a>To fit a model with an interaction term between two variables, include the interaction via the <span class="in">`*`</span> operator like so:</span>
<span id="cb48-473"><a href="#cb48-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-474"><a href="#cb48-474" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-475"><a href="#cb48-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-476"><a href="#cb48-476" aria-hidden="true" tabindex="-1"></a>pos_int_nba_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> position <span class="sc">+</span> INSERT_VARIABLE <span class="sc">+</span></span>
<span id="cb48-477"><a href="#cb48-477" aria-hidden="true" tabindex="-1"></a>                       position <span class="sc">*</span> INSERT_VARIABLE, </span>
<span id="cb48-478"><a href="#cb48-478" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-479"><a href="#cb48-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-480"><a href="#cb48-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-481"><a href="#cb48-481" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-482"><a href="#cb48-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-483"><a href="#cb48-483" aria-hidden="true" tabindex="-1"></a>gender_int_cost_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Gender <span class="sc">+</span> INSERT_VARIABLE <span class="sc">+</span></span>
<span id="cb48-484"><a href="#cb48-484" aria-hidden="true" tabindex="-1"></a>                       Gender <span class="sc">*</span> INSERT_VARIABLE, </span>
<span id="cb48-485"><a href="#cb48-485" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> heart_disease)</span>
<span id="cb48-486"><a href="#cb48-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-487"><a href="#cb48-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-488"><a href="#cb48-488" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (ALL TOGETHER NOW)</span></span>
<span id="cb48-489"><a href="#cb48-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-490"><a href="#cb48-490" aria-hidden="true" tabindex="-1"></a>__Replace the predictions in the previous plot's `mutate` code with this interaction model's predictions.__ How do they compare to the results from <span class="in">`geom_smooth()`</span> now?</span>
<span id="cb48-491"><a href="#cb48-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-492"><a href="#cb48-492" aria-hidden="true" tabindex="-1"></a>You can model interactions between any type of variables using the <span class="in">`*`</span> operator, feel free to experiment on your different possible continuous variables.</span>
<span id="cb48-493"><a href="#cb48-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-494"><a href="#cb48-494" aria-hidden="true" tabindex="-1"></a><span class="fu">### 9. Polynomials</span></span>
<span id="cb48-495"><a href="#cb48-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-496"><a href="#cb48-496" aria-hidden="true" tabindex="-1"></a>Another way to increase the explanatory power of your model is to include transformations of continuous variables. For instance you can directly create a column that is a square of a variable with <span class="in">`mutate()`</span> and then fit the regression with the original variable and its squared term:</span>
<span id="cb48-497"><a href="#cb48-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-498"><a href="#cb48-498" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-499"><a href="#cb48-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-500"><a href="#cb48-500" aria-hidden="true" tabindex="-1"></a>nba_data_2022 <span class="ot">&lt;-</span> nba_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb48-501"><a href="#cb48-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fg_perc_squared =</span> field_goal_percentage<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-502"><a href="#cb48-502" aria-hidden="true" tabindex="-1"></a>squared_fg_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> field_goal_percentage <span class="sc">+</span> fg_perc_squared, </span>
<span id="cb48-503"><a href="#cb48-503" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-504"><a href="#cb48-504" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(squared_fg_lm)</span>
<span id="cb48-505"><a href="#cb48-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-506"><a href="#cb48-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-507"><a href="#cb48-507" aria-hidden="true" tabindex="-1"></a>__What are some difficulties with interpreting this model fit?__ View the predictions for this model or other covariates you squared.</span>
<span id="cb48-508"><a href="#cb48-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-509"><a href="#cb48-509" aria-hidden="true" tabindex="-1"></a>The <span class="in">`poly()`</span> function allows us to build higher-order polynomial transformations of variables easily. Run the following code chunk to fit a 9th-order polynomial model (i.e. $Y = \beta_0 + \beta_1x + \beta_2x^2 + \ldots + \beta_9x^9$) between minutes / game and field goal percentage. </span>
<span id="cb48-510"><a href="#cb48-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-511"><a href="#cb48-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-512"><a href="#cb48-512" aria-hidden="true" tabindex="-1"></a>poly_nine_fg_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">9</span>), </span>
<span id="cb48-513"><a href="#cb48-513" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> nba_data_2022)</span>
<span id="cb48-514"><a href="#cb48-514" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_nine_fg_lm)</span>
<span id="cb48-515"><a href="#cb48-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-516"><a href="#cb48-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-517"><a href="#cb48-517" aria-hidden="true" tabindex="-1"></a>__Do you think this is appropriate, how did this change your predictions compared to the previous plot or when only using the variable without any transformation?__</span>
<span id="cb48-518"><a href="#cb48-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-519"><a href="#cb48-519" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-520"><a href="#cb48-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-521"><a href="#cb48-521" aria-hidden="true" tabindex="-1"></a>heart_disease <span class="ot">&lt;-</span> heart_disease <span class="sc">%&gt;%</span></span>
<span id="cb48-522"><a href="#cb48-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration_squared =</span> Duration<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-523"><a href="#cb48-523" aria-hidden="true" tabindex="-1"></a>squared_duration_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> Duration <span class="sc">+</span> duration_squared, </span>
<span id="cb48-524"><a href="#cb48-524" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> heart_disease)</span>
<span id="cb48-525"><a href="#cb48-525" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(squared_duration_lm)</span>
<span id="cb48-526"><a href="#cb48-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-527"><a href="#cb48-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-528"><a href="#cb48-528" aria-hidden="true" tabindex="-1"></a>__What are some difficulties with interpreting this model fit?__ View the predictions for this model or other covariates you squared.</span>
<span id="cb48-529"><a href="#cb48-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-530"><a href="#cb48-530" aria-hidden="true" tabindex="-1"></a>The <span class="in">`poly()`</span> function allows us to build higher-order polynomial transformations of variables easily. Run the following code chunk to fit a 9th-order polynomial model (i.e. $Y = \beta_0 + \beta_1x + \beta_2x^2 + \ldots + \beta_9x^9$) between <span class="in">`log_cost`</span> and <span class="in">`Duration`</span>. </span>
<span id="cb48-531"><a href="#cb48-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-532"><a href="#cb48-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-533"><a href="#cb48-533" aria-hidden="true" tabindex="-1"></a>poly_nine_duration_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">9</span>), </span>
<span id="cb48-534"><a href="#cb48-534" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> heart_disease)</span>
<span id="cb48-535"><a href="#cb48-535" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(poly_nine_duration_lm)</span>
<span id="cb48-536"><a href="#cb48-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-537"><a href="#cb48-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-538"><a href="#cb48-538" aria-hidden="true" tabindex="-1"></a>__Do you think this is appropriate, how did this change your predictions compared to the previous plot or when only using the variable without any transformation?__</span>
<span id="cb48-539"><a href="#cb48-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-540"><a href="#cb48-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### 10. Training and testing</span></span>
<span id="cb48-541"><a href="#cb48-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-542"><a href="#cb48-542" aria-hidden="true" tabindex="-1"></a>As we've seen, using transformations such as higher-order polynomials may decrease the interpretability and increase the potential for overfitting associated with our models; however, they can also dramatically improve the explanatory power.</span>
<span id="cb48-543"><a href="#cb48-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-544"><a href="#cb48-544" aria-hidden="true" tabindex="-1"></a>We need a way for making sure our more complicated models have not overly fit to the noise present in our data. Another way of saying this is that a good model should generalize to a different sample than the one on which it was fit. This intuition motivates the idea of training/testing. We split our data into two parts, use one part -- the training set -- to fit our models, and the other part -- the testing set -- to evaluate our models. Any model which happens to fit to the noise present in our training data should perform poorly on our testing data.  </span>
<span id="cb48-545"><a href="#cb48-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-546"><a href="#cb48-546" aria-hidden="true" tabindex="-1"></a>NOTE: We split our data randomly using the <span class="in">`sample()`</span> function, which means that each time you run this code you'll get a different result... UNLESS you set a seed. This makes the code reproducible, as the seed starts the (pseudo)random number generator. Always remember to <span class="in">`set.seed()`</span> any time your methods involve randomness. Feel free to use any numbers you like (Prof. Yurko generally uses the years that the Pittsburgh Pirates won the world series, but you do whatever you like).</span>
<span id="cb48-547"><a href="#cb48-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-548"><a href="#cb48-548" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (SPORTS)</span></span>
<span id="cb48-549"><a href="#cb48-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-550"><a href="#cb48-550" aria-hidden="true" tabindex="-1"></a>The first thing we will need to do is split our sample. Run the following code chunk to divide our data into two halves, which we will refer to as a training set and a test set. Briefly summarize what each line in the code chunk is doing.</span>
<span id="cb48-551"><a href="#cb48-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-552"><a href="#cb48-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-553"><a href="#cb48-553" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>) <span class="co"># CHANGE THIS NUMBER</span></span>
<span id="cb48-554"><a href="#cb48-554" aria-hidden="true" tabindex="-1"></a>n_players <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nba_data_2022)</span>
<span id="cb48-555"><a href="#cb48-555" aria-hidden="true" tabindex="-1"></a>train_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(n_players, n_players <span class="sc">/</span> <span class="dv">2</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb48-556"><a href="#cb48-556" aria-hidden="true" tabindex="-1"></a>test_i <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>n_players)[<span class="sc">-</span>train_i]</span>
<span id="cb48-557"><a href="#cb48-557" aria-hidden="true" tabindex="-1"></a>nba_train <span class="ot">&lt;-</span> nba_data_2022[train_i,]</span>
<span id="cb48-558"><a href="#cb48-558" aria-hidden="true" tabindex="-1"></a>nba_test <span class="ot">&lt;-</span> nba_data_2022[test_i,]</span>
<span id="cb48-559"><a href="#cb48-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-560"><a href="#cb48-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-561"><a href="#cb48-561" aria-hidden="true" tabindex="-1"></a>We will now compare three candidate models for predicting minutes played using position and field goal percentage. We will fit these models on the **training data** only, ignoring the testing data for the moment. Run the below two code chunks to create two candidate models:</span>
<span id="cb48-562"><a href="#cb48-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-563"><a href="#cb48-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-564"><a href="#cb48-564" aria-hidden="true" tabindex="-1"></a>candidate_model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>) <span class="sc">+</span> position <span class="sc">+</span></span>
<span id="cb48-565"><a href="#cb48-565" aria-hidden="true" tabindex="-1"></a>                          position <span class="sc">*</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>), </span>
<span id="cb48-566"><a href="#cb48-566" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> nba_train)</span>
<span id="cb48-567"><a href="#cb48-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-568"><a href="#cb48-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-569"><a href="#cb48-569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-570"><a href="#cb48-570" aria-hidden="true" tabindex="-1"></a>candidate_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(min_per_game <span class="sc">~</span> <span class="fu">poly</span>(field_goal_percentage, <span class="dv">2</span>) <span class="sc">+</span> position, </span>
<span id="cb48-571"><a href="#cb48-571" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> nba_train)</span>
<span id="cb48-572"><a href="#cb48-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-573"><a href="#cb48-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-574"><a href="#cb48-574" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`summary()`</span>, which of these models has more explanatory power according to the training data? Which of the models is less likely to overfit?</span>
<span id="cb48-575"><a href="#cb48-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-576"><a href="#cb48-576" aria-hidden="true" tabindex="-1"></a>__Fit another model to predict minutes / game using a different set of variables / polynomials__. </span>
<span id="cb48-577"><a href="#cb48-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-578"><a href="#cb48-578" aria-hidden="true" tabindex="-1"></a>Now that we've built our candidate models, we will evaluate them on our test set, using the criterion of mean squared error (MSE). Run the following code chunk to compute, on the test set, the MSE of predictions given by the first model compared to the actual minutes played.</span>
<span id="cb48-579"><a href="#cb48-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-580"><a href="#cb48-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-581"><a href="#cb48-581" aria-hidden="true" tabindex="-1"></a>model_1_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(candidate_model_1, <span class="at">newdata =</span> nba_test)</span>
<span id="cb48-582"><a href="#cb48-582" aria-hidden="true" tabindex="-1"></a>model_1_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((model_1_preds <span class="sc">-</span> nba_test<span class="sc">$</span>min_per_game)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-583"><a href="#cb48-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-584"><a href="#cb48-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-585"><a href="#cb48-585" aria-hidden="true" tabindex="-1"></a>__Do this for each of your candidate models__. Compare the MSE on the test set, which model performed best (lowest test MSE)?</span>
<span id="cb48-586"><a href="#cb48-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-587"><a href="#cb48-587" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (HEALTH)</span></span>
<span id="cb48-588"><a href="#cb48-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-589"><a href="#cb48-589" aria-hidden="true" tabindex="-1"></a>The first thing we will need to do is split our sample. Run the following code chunk to divide our data into two halves, which we will refer to as a training set and a test set. Briefly summarize what each line in the code chunk is doing.</span>
<span id="cb48-590"><a href="#cb48-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-591"><a href="#cb48-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb48-592"><a href="#cb48-592" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>) <span class="co"># CHANGE THIS NUMBER</span></span>
<span id="cb48-593"><a href="#cb48-593" aria-hidden="true" tabindex="-1"></a>n_patients <span class="ot">&lt;-</span> <span class="fu">nrow</span>(heart_disease)</span>
<span id="cb48-594"><a href="#cb48-594" aria-hidden="true" tabindex="-1"></a>train_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(n_patients, n_patients <span class="sc">/</span> <span class="dv">2</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb48-595"><a href="#cb48-595" aria-hidden="true" tabindex="-1"></a>test_i <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>n_patients)[<span class="sc">-</span>train_i]</span>
<span id="cb48-596"><a href="#cb48-596" aria-hidden="true" tabindex="-1"></a>heart_train <span class="ot">&lt;-</span> heart_disease[train_i,]</span>
<span id="cb48-597"><a href="#cb48-597" aria-hidden="true" tabindex="-1"></a>heart_test <span class="ot">&lt;-</span> heart_disease[test_i,]</span>
<span id="cb48-598"><a href="#cb48-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-599"><a href="#cb48-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-600"><a href="#cb48-600" aria-hidden="true" tabindex="-1"></a>We will now compare three candidate models for predicting <span class="in">`log_cost`</span> using <span class="in">`Gender`</span> and <span class="in">`Duration`</span>. We will fit these models on the **training data** only, ignoring the testing data for the moment. Run the below two code chunks to create two candidate models:</span>
<span id="cb48-601"><a href="#cb48-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-602"><a href="#cb48-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-603"><a href="#cb48-603" aria-hidden="true" tabindex="-1"></a>candidate_model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>) <span class="sc">+</span> Gender <span class="sc">+</span></span>
<span id="cb48-604"><a href="#cb48-604" aria-hidden="true" tabindex="-1"></a>                          Gender <span class="sc">*</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>), </span>
<span id="cb48-605"><a href="#cb48-605" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> heart_train)</span>
<span id="cb48-606"><a href="#cb48-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-607"><a href="#cb48-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-608"><a href="#cb48-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-609"><a href="#cb48-609" aria-hidden="true" tabindex="-1"></a>candidate_model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_cost <span class="sc">~</span> <span class="fu">poly</span>(Duration, <span class="dv">2</span>) <span class="sc">+</span> Gender, </span>
<span id="cb48-610"><a href="#cb48-610" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> heart_train)</span>
<span id="cb48-611"><a href="#cb48-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-612"><a href="#cb48-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-613"><a href="#cb48-613" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`summary()`</span>, which of these models has more explanatory power according to the training data? Which of the models is less likely to overfit?</span>
<span id="cb48-614"><a href="#cb48-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-615"><a href="#cb48-615" aria-hidden="true" tabindex="-1"></a>__Fit another model to predict `log_cost` using a different set of variables / polynomials__. </span>
<span id="cb48-616"><a href="#cb48-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-617"><a href="#cb48-617" aria-hidden="true" tabindex="-1"></a>Now that we've built our candidate models, we will evaluate them on our test set, using the criterion of mean squared error (MSE). Run the following code chunk to compute, on the test set, the MSE of predictions given by the first model compared to the actual <span class="in">`log_cost`</span>.</span>
<span id="cb48-618"><a href="#cb48-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-619"><a href="#cb48-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb48-620"><a href="#cb48-620" aria-hidden="true" tabindex="-1"></a>model_1_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(candidate_model_1, <span class="at">newdata =</span> heart_test)</span>
<span id="cb48-621"><a href="#cb48-621" aria-hidden="true" tabindex="-1"></a>model_1_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((model_1_preds <span class="sc">-</span> heart_test<span class="sc">$</span>log_cost)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb48-622"><a href="#cb48-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-623"><a href="#cb48-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-624"><a href="#cb48-624" aria-hidden="true" tabindex="-1"></a>__Do this for each of your candidate models__. Compare the MSE on the test set, which model performed best (lowest test MSE)?</span>
<span id="cb48-625"><a href="#cb48-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-626"><a href="#cb48-626" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2023 by <a href="https://www.cmu.edu">Carnegie Mellon University</a> <br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a><br> With <i class="fa-solid fa-heart" aria-label="heart"></i> to our <a href="../credits.html">Website Credits</a></div>
  </div>
</footer>



</body></html>